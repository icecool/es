<?php
namespace APP\MVC\V;

class MAP_V {

    public function main($model){
    	$result='';
    	\CORE\BC\UI::init()->pos['link'].='<link rel="stylesheet" href="'.UIPATH.'/ext/map/leaflet.css" />';
    	\CORE\BC\UI::init()->pos['js'].='
    	<script src="'.UIPATH.'/ext/map/leaflet.js"></script>
    	<script src="'.UIPATH.'/ext/map/singleclick.js"></script>
		<script language="javascript">
	        function init() {
	            var map = new L.Map(\'map\');

	            L.tileLayer(\'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {
	                attribution: \'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors\',
	                maxZoom: 18
	            }).addTo(map);
	            map.attributionControl.setPrefix(\'\'); // Dont show the Powered by Leaflet text.

	            var dushanbe = new L.LatLng(38.5495108,68.7781477);
	            map.setView(dushanbe, 12);

	            // Define an array. This could be done in a seperate js file.
	            // This tidy formatted section could even be generated by a server-side script
	            // or fetched seperately as a jsonp request.
	            var markers = [
	                [ 68.780057,38.579006, "Флаги баландтарин дар Осиё" ],
	                [ 68.785250,38.583032, "Хонаи ман" ],
	                [ 68.787267, 38.584701, \'Биё чойхурива бача<br><a href="https://en.wikipedia.org/wiki/Nelsons_Column">wp</a><br/><img src="http://agroinform.tj/informers/prices/generate.php" alt="Рыночные цены Таджикистана"  />\' ]
	            ];

	            //Loop through the markers array
	            for (var i=0; i<markers.length; i++) {

	                var lon = markers[i][0];
	                var lat = markers[i][1];
	                var popupText = markers[i][2];

	                var markerLocation = new L.LatLng(lat, lon);
	                var marker = new L.Marker(markerLocation);
	                map.addLayer(marker);

	                marker.bindPopup(popupText);

	            }

	            // test

	            map.on("singleclick",function ( e ) {
	                if (confirm("Добавить учереждение?")) {
	                    var markerLocation = new L.LatLng(e.latlng.lat, e.latlng.lng);
	                    var marker = new L.Marker(markerLocation);
	                    map.addLayer(marker);
	                    //console.log( "singleclick", e );
	                    //L.popup().setLatLng( e.latlng )
	                    //    .setContent( "<p><code>singleclick</code> at " + e.latlng )
	                    //    .openOn( map );
	                    alert(e.latlng.lat + \' : \' + e.latlng.lng);
	                }
	            } );

	        }
	        $(document).ready(function() {

	        	init();

			});
	    </script>
    	';
    	$result.='<div id="map" style="height: 540px"></div>';
		return $result;
    }


}